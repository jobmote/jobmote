<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meine Inserate â€“ jobmote.de</title>
  <link rel="icon" type="image/jpeg" href="assets/favicon.png">
  <link rel="stylesheet" href="css/style.css" />

  <!-- Company-Guard: nur eingeloggte User mit role=company -->
  <script type="module">
    import { supabase } from "./js/supabase.js";

    const { data } = await supabase.auth.getSession();
    if (!data?.session) {
      location.replace("/login/");
    }

    const userId = data.session.user.id;

    const { data: profile, error } = await supabase
      .from("profiles")
      .select("role")
      .eq("id", userId)
      .single();

    if (error) {
      console.error("Company guard: profile load error", error);
      location.replace("/");
    }

    if ((profile?.role || "").toLowerCase() !== "company") {
      location.replace("/"); // kein Zugriff
    }
  </script>
</head>

<body data-page="my-posted-jobs">
  <header class="site-header">
    <div class="header-left">
      <a class="brand-link" href="index.html" aria-label="Startseite">
        <img src="assets/favicon.png" alt="jobmote.de" class="brand-icon" />
        jobmote.de
      </a>
    </div>

    <div class="header-center">
      <form id="site-search-form" class="search-form" action="search.html" method="GET">
        <input id="site-search-input" class="search-bar" name="q" type="text" placeholder="Suche Jobs, Firmen, Keywordsâ€¦ ðŸ”Ž" autocomplete="off" />
      </form>
    </div>

    <div class="header-right">
      <button class="icon-btn" id="account-btn" type="button" aria-label="Account">
        <svg class="icon-svg-user" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="8" r="4"></circle>
          <path d="M4 20c0-4 4-6 8-6s8 2 8 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <button class="icon-btn" id="menu-toggle" type="button" aria-label="MenÃ¼ Ã¶ffnen" aria-controls="side-menu" aria-expanded="false">â˜°</button>
    </div>
  </header>

  <div id="menu-overlay" class="menu-overlay" aria-hidden="true"></div>

  <nav id="side-menu" class="side-menu" aria-label="SeitenmenÃ¼">
    <div class="side-menu-header">
      <span class="side-menu-title">MenÃ¼</span>
      <button class="close-btn" id="menu-close" type="button" aria-label="MenÃ¼ schlieÃŸen">âœ•</button>
    </div>

    <ul class="menu-list" id="menu-list"></ul>
  </nav>

  <main class="legal-container">
    <section class="legal-card">
      <h1>Meine Inserate</h1>
      <p class="muted">Hier siehst du nur die Jobs, die du mit diesem Unternehmens-Account erstellt hast.</p>

      <div class="results-bar simple">
        <div class="results-meta">
          <span id="myj-count">â€“</span>
          <span class="muted">Inserate</span>
        </div>
        <div class="results-actions">
          <a class="btn btn-ghost" href="post-job.html">Neuen Job erstellen</a>
        </div>
      </div>

      <div id="myj-list" class="job-list"></div>

      <div id="myj-empty" class="empty" hidden>
        <h3>Noch keine Inserate</h3>
        <p class="muted">Erstelle deinen ersten Job Ã¼ber â€žJob einstellenâ€œ.</p>
        <a class="btn" href="post-job.html">Job einstellen</a>
      </div>
    </section>
  </main>

  <!-- Modal (wird fÃ¼r Jobcards benÃ¶tigt) -->
  <div id="job-modal-backdrop" class="modal-backdrop" aria-hidden="true" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-label="Jobdetails">
      <div class="modal-header">
        <span id="job-modal-badge" class="pill">â€“</span>
        <button id="job-modal-close" class="close-btn" type="button" aria-label="SchlieÃŸen">âœ•</button>
      </div>
      <div class="modal-body">
        <h2 id="job-modal-title">â€“</h2>
        <p class="muted" id="job-modal-employer">â€“</p>

        <div class="card-meta" style="margin-top: 12px;">
          <span class="tag"><strong id="job-modal-pay">â€“</strong> / Std</span>
          <span class="tag" id="job-modal-hours">â€“</span>
          <span class="tag" id="job-modal-lang">â€“</span>
          <span class="tag" id="job-modal-region">â€“</span>
        </div>

        <p id="job-modal-desc" style="margin-top: 14px;">â€“</p>
        <ul id="job-modal-req" class="muted" style="margin-top: 10px;"></ul>
      </div>
      <div class="modal-footer">
        <a id="job-modal-link" class="btn btn-ghost" href="#" target="_blank" rel="noopener">Zum Anbieter</a>
        <button id="job-modal-save" class="btn" type="button">â˜… Job speichern</button>
      </div>
    </div>
  </div>

  <script defer src="js/core.js"></script>
  <script defer src="js/theme.js"></script>
  <script type="module" src="js/auth-session.js"></script>
  <script defer src="js/jobs.data.js"></script>
  <script defer src="js/jobs.service.js"></script>
  <script defer src="js/favorites.v2.js"></script>
  <script defer src="js/ui.menu.js"></script>
  <script defer src="js/render.js"></script>
  <script defer src="js/ui.modal.js"></script>
  <script defer src="js/page.home.js"></script>
  <script defer src="js/page.favorites.js"></script>
  <script defer src="js/page.search.js"></script>
  <script defer src="js/page.postjob.js"></script>

  <!-- optional: cache buster -->
  <script defer src="js/page.my-posted-jobs.js?v=1"></script>

  <script defer src="js/app.js"></script>
</body>
</html>

